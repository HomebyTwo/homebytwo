{% extends "base.html" %}
{% load static leaflet_tags geojson_tags humanize %}

{% block title %}Home by Two - Import {{ route.name }}{% endblock %}

{% block extralinks %}
    {% leaflet_js %}
    {% leaflet_css %}
{% endblock extralinks %}

{% block content %}
    <h1>Import Route</h1>
    {% if response.error %}
        {% include "importers/switzerland_mobility/includes/_alert.html" %}
    {% endif %}

    {% if route %}
        <form class="box" method="post" action="{% url 'switzerland_mobility_detail' route.source_id %}">
            <div class="grid form-group">
                {{ form.name.errors }}
                <label for="{{ form.name.id_for_label }}">Route name:</label>
                {{ form.name }}
            </div>
            <h3 class="mrgv0 text-center">{{ route.get_length.km|floatformat:1|intcomma }}km - {{ route.get_totalup.m|floatformat:0|intcomma }}m+ - {{ route.get_totaldown.m|floatformat:0|intcomma }}m-</h3>
            <div class="clearfix mrg">
                <div class="pull-left">&lsaquo; <a href="{% url "switzerland_mobility_index" %}" title="list of Switzerland Mobility routes">Back</a></div>
            </div>
            {% csrf_token %}
            {% include 'importers/switzerland_mobility/includes/_checkpoints.html' %}
            <div>{{ form.source_id }}</div>
            <div>{{ form.totalup }}</div>
            <div>{{ form.totaldown }}</div>
            <div>{{ form.length }}</div>
            <div>{{ form.geom }}</div>
            <div class="form-group text-center mrg">
                {% if not route.already_imported %}
                    <input type="submit" value="Import" class="btn btn--md btn--primary">
                {% else %}
                    <p class="btn btn--md btn--default" Disabled>Already Imported</p>
                {% endif %}
            </div>
        </form>
    {% endif %}
    {% if route.geom %}
        {% leaflet_map "main" callback="route_map_init" %}
    {% endif %}

{% endblock content %}

{% if route.geom %}
    {% block extrajs %}
        <script type="text/javascript">
            function route_map_init (map, options) {
                var route = L.geoJson({{ route.geom|geojsonfeature|safe }});
                route.addTo(map);
                map.fitBounds(route.getBounds());
                map.scrollWheelZoom.disable();
            }
        </script>
    {% endblock extrajs %}
{% endif %}